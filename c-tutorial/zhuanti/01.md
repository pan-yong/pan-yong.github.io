## 专题一

> 数据类型、常量和变量、运算符（优先级）与表达式。

##### 1. 左值和右值

**左值**，出现在赋值符号左边，表示计算机内存中的一个位置。**右值**，出现在赋值符号右边，表示一个值。举例：

```c
a = b + 25
```

a是一个左值，它标识一个可以存储结果值的地点，b+25是一个右值，它指一个值。它们可以互换吗？

```c
b + 25 = a;
```

不可以，`b+25=a`，是非法的赋值语句，因为b+25的值必然存储在某个地方，但是程序员没办法知道该结果存储在哪里，也无法保证这个表达式的值下次还是会存储于那个地方，所以`b+25` 不能作为左值。  一般变量可以作为左值，表达式只能作为右值，但这几个运算符`[] .  ->  *` 表达式可以作为左值。

```c
a[b+10] = 10;        s.math = 90;      r->data = 5;      *(p+3) = 60;  
```

##### 2. 运算符优先级与求值次序

复杂表达式的求值顺序由3个因素决定：运算符优先级、运算符结合性、运算符是否控制执行顺序。相邻两个运算符，哪个先执行取决于它们的优先级。如果优先级相同，执行顺序取决于它们的结合性，结合性是指运算符是从左向右执行还是从右向左执行。有四个运算符（&&  ||  ?  ,  ）能对整个表达式的执行顺序施加控制。

```tex
初等： () [] . ->                         结合性： L-R
单目： ++ -- ! ~ * & sizeof (类型) - +    结合性：  R-L    例外：a++ , b++ 结合性是 L-R 
算术：* / + - << >>                       结合性： L-R
关系： > >= < <= == !=                    结合性： L-R
逻辑： & ^ | && ||                        结合性： L-R     &&和|| 控制求值顺序
条件： ?:                                                 控制求值顺序
赋值：= += -= *= /= %= <<= >>= &= ^= |=   结合型：R-L
逗号：,                                   结合性： L-R     控制求值顺序
```

写出下面表达式值：

```c
int k = 3, a = 3, b = 2, c = 1;
printf("%d", k < a ? k : c < b ? c : a );

int a = 3, b = 4, c = 5;
c = a > b ? a++ : b++;
printf("%d %d %d",a,b,c);

int x = 10, y = 9, a, b, c;
a = --x==y++ ? --x : ++y;
b = x++;c=y;
printf("%d %d %d",a,b,c);
-------------------------------------------------------------------------
int a = 3 > 4;	printf("%d", a);

int b = 3+4==5; printf("%d", b);

int a = 1, b = 2, c = 3, d = 4, m = 2, n = 2;
printf("%d", (m=a>b) && (n=c>d) );

int a = 7, b = 6, c = 12;
printf("%d", a+b<c && a>b);

int a = 3, b = 4, c = 5;
printf("%d ", !(a+b)+c-1&&b+c/2 );
printf("%d ", !(a+b)&&!c||1 );
printf("%d", a+b>c&&(b=c));

int a = 1, b = 1, c = 1;
++a||++b&&++c;
printf("%d %d %d",a,b,c);

int a = 6, b = 4, c = 2;
printf("%d", !(a-b)+c-1&&b+c/2);

int a = 6, b = 4, c = 3;
printf("%d", a&&b+c||b-c);

int a = 3, b = 4, c = 5;
printf("%d", a||b+c&&b==c);

int x = 1, y = 2, z = 3;
x = y--<=x || x + y != z;
printf("%d %d", x, y);
------------------------------------------------------------------------
注意：sizeof 是运算符，右结性 R-L，不是函数。举例：
    
    int n = 3;
    printf("%d", sizeof n);      // 说明sizeof 是运算符  结合性 R-L  从右至左

    printf("%d ", sizeof(n=5));  // 并不执行n=5  说明sizeof是运算符  而不是函数
    printf("%d", n);
```

##### 3. 应该避免的表达式

表达式的求值顺序由3个因素决定：运算符优先级、运算符结合性、运算符是否控制执行顺序。只要不违背这三个规则，编译器可以自由决定用任何顺序进行求值。

```c
x + y + z
执行顺序可以是：
    x + y
    (x + y) + z
也可以是：
    y + z
    (y + z) + x
K&R C：可以先计算 y + z，是因为y和z的值可能可以从前面的一些表达式中获得，直接复用比重新求值效率更高。

a*b+c*d+e*f
执行顺序可以是：
    a*b  
    c*d  
    (a*b)+(c*d)   
    e*f  
    (a*b)+(c*d)+(e*f)
执行顺序还可以是：
    a*b 
    c*d
	e*f
    (a*b)+(c*d)
    (a*b)+(c*d)+(e*f)

```

1. C语言没有指定同一运算符中多个操作数的计算顺序。（&&   ||   ?: 和 ,  除外）

```c
这类表达式应该避免：
	c + --c
    
这类函数调用也一样要避免：    
    f() + g() 
如果函数修改了全局变量，不同的执行顺序可能产生不同结果，应该改为：
temp = f();
temp += g();

```

2. C语言也没有指定函数各参数的执行顺序

```c
这里表达式应该避免：
    printf("%d %d", ++i, i++);
    printf("%d %d", ++n, power(2,n));

```

3. 有副作用的表达式

```c
	a[i] = i++;
    y[i++] = x[i];
    y[i] = x[i];
数组下标到底是引用旧值还是新值？不同的编译器可能解释不同，因此产生的结果不同。
```

以上表达式是未定义的行为，代码的执行结果与求值顺序相关，而并不确定各个机器各自是如何处理的，不同的编译器中可能会有不同的结果，都不是好的程序设计，应该避免。

###### 参考书

1. K&R 《C程序设计语言》 2.12 运算符优先级与求值次序  P43 
2. Kenneth A. Reek 《C 和指针》第5章 操作符和表达式  P81 ~ P84
3. Andrew Koenig 《C缺陷与陷阱》3.7 求值顺序 P57